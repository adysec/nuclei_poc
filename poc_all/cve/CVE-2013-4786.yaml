id: CVE-2013-4786

info:
  name: IPMI 2.0 RAKP Authentication Remote Password Hash Disclosure
  author: geeknik
  severity: high
  description: The IPMI 2.0 specification supports RMCP+ Authenticated Key-Exchange Protocol authentication, which allows remote attackers to obtain password hashes and conduct offline password guessing attacks by extracting HMAC from a BMC response during authentication.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2013-4786
    - http://fish2.com/ipmi/remote-pw-cracking.html
    - https://www.rapid7.com/blog/post/2013/07/02/a-penetration-testers-guide-to-ipmi/
  classification:
    cve-id: CVE-2013-4786
    cwe-id: CWE-255
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 7.5
  tags: cve,cve2013,ipmi,rakp,authentication-bypass,network

network:
  - inputs:
      - data: 0600ff07000000000000000000092018c88100388e04b5
        type: hex
      - data: 0600ff0700000000000000000009201cc88100388e04b5
        type: hex

    host:
      - "{{Hostname}}:623"

    matchers-condition: and
    matchers:
      - type: binary
        binary:
          - "0600ff07"
        name: ipmi_rmcp_response
        condition: and

      - type: regex
        regex:
          - "\\x06\\x00\\xff\\x07.*\\x00\\x00\\x00\\x08"
        name: ipmi_session_response
        condition: and

      - type: binary
        binary:
          - "060000"
          - "ff07"
        name: ipmi_rakp_response
        condition: and

    extractors:
      # Extract IPMI 2.0 RAKP2 HMAC-SHA1 (20-byte / 40 hex-char value beginning at fixed offset)
      # The HMAC appears after the 40-byte session header; anchor extraction after 0x06 0x00 0xff 0x07
      - type: regex
        name: rakp2_hmac_sha1
        regex:
          - "\\x06\\x00\\xff\\x07[\\x00-\\xff]{36}([a-fA-F0-9]{40})"
        part: body
