id: autodiscover-user-enumeration-via-X-BackEndCookie-detect

info:
  name: Microsoft Autodiscover - X-BackEndCookie User Enumeration
  author: salavoz
  severity: medium
  description: |
    Detects unauthenticated user enumeration via X-BackEndCookie from Autodiscover JSON endpoint.

http:
  - raw:
      - |
        GET /autodiscover/autodiscover.json/v1.0/user@example.com?Protocol=Autodiscoverv1 HTTP/1.1
        Host: {{Host}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        Connection: close

    matchers:
      - type: word
        name: cookie
        part: header
        words:
          - "X-BackEndCookie"

    extractors:
      - type: regex
        part: header
        group: 1
        name: xbackendcookie_value
        regex:
          - "X-BackEndCookie=([^;]*)"
