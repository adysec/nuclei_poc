info:
  id: vmware-cve-2021-21975
  name: VMware vCenter Server SSRF Vulnerability
  author: OpenAI
  description: Template to detect the presence of CVE-2021-21975 on VMware vCenter Server
  severity: High
  classification:
    country: any
    tags:
      - vmware
      - cve
      - ssrf
      - vulnerability

  reference:
    - https://www.vmware.com/security/advisories/VMSA-2021-0010.html

  matcher-condition: or

  requests:
      method: POST
      path:
        - "/ui/h5-vsan/rest/proxy/service/&vsanQueryUtilSvc.getVsanConfig"
      headers:
        Content-Type: application/json
      body:
        vsanQueryUtilSpec:
          method: "fetch-vm-metadata"
          data:
            includeObjUuids: ["1234"]
      description: Attempt to exploit CVE-2021-21975
      condition: or

  matchers:
    - pattern: "is not accessible from the network"
      type: body
      description: Server responds with error message indicating network access failure

  response:
    - status:
        - 404
      description: Server responds with 404 error
