id: CVE-2023-4863

info:
  name: CVE-2023-4863
  author: dwisiswant0
  severity: high
  description: |
    Heap buffer overflow in libwebp in Google Chrome prior to 116.0.5845.187
    and libwebp 1.3.2 allowed a remote attacker to perform an out of bounds
    memory write via a crafted HTML page.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2023-4863
    - https://github.com/mistymntncop/CVE-2023-4863
    - https://github.com/bbaranoff/CVE-2023-4863
    - https://github.com/talbeerysec/BAD-WEBP-CVE-2023-4863
    - https://github.com/OITApps/Find-VulnerableElectronVersion
    - https://github.com/GTGalaxi/ElectronVulnerableVersion
    - https://github.com/murphysecurity/libwebp-checker

self-contained: true

javascript:
  - code: |
      const fs = require('nuclei/fs');
      const isElectron = /Electron v.*/g,
        vulnPattern = /(VP8LBuildHuffmanTable|WebPCopyP(ixels|lane))/g,
        vulnVersions = [22, 24, 25, 26],
        safeString = 'VP8LHuffmanTablesAllocate';
      let vuln = false;
      try {
        const f = fs.ReadFileAsString(file);
        vuln = f.match(vulnPattern) && !f.includes(safeString);
        if (!vuln) {
          let electron = f.match(isElectron);
          if (electron[0] !== null) {
            for (const vulnVersion of vulnVersions) {
              vuln = electron[0].includes(vulnVersion.toString());
              if (vuln) break;
            }
          }
        }
      } catch (e) { vuln; }
      vuln;

    args:
      file: "{{file}}"

    matchers:
      - type: dsl
        dsl:
          - "success && response" # shorthand for 'success == true && response == true'

    extractors:
      - type: dsl
        dsl:
          - file