id: CVE-2025-24016

info:
  name: CVE-2025-24016
  author: rxerium
  severity: critical
  description: Wazuh is a free and open source platform used for threat prevention, detection, and response. Starting in version 4.4.0 and prior to version 4.9.1, an unsafe deserialization vulnerability allows for remote code execution on Wazuh servers. DistributedAPI parameters are a serialized as JSON and deserialized using `as_wazuh_object` (in `framework/wazuh/core/cluster/common.py`). If an attacker manages to inject an unsanitized dictionary in DAPI request/response, they can forge an unhandled exception (`__unhandled_exc__`) to evaluate arbitrary python code. The vulnerability can be triggered by anybody with API access (compromised dashboard or Wazuh servers in the cluster) or, in certain configurations, even by a compromised agent. Version 4.9.1 contains a fix.
  reference:
    - https://www.cve.org/CVERecord?id=CVE-2025-24016
    - https://www.cisa.gov/known-exploited-vulnerabilities-catalog
  tags: cve,kev,wazuh,deserialization

http:
  - method: GET
    redirects: true
    max-redirects: 3
    path:
      - "{{BaseURL}}"
      - "{{BaseURL}}/app/login?"

    extractors:
      - type: regex
        name: wazuh_version
        part: body
        group: 1
        regex:
          - 'wazuhVersion(?:&quot;|"):&quot;?([0-9]+\.[0-9]+\.[0-9]+)'

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "<title>Wazuh</title>"
          - "wazuhVersion"
        part: body
        condition: and

      - type: dsl
        dsl:
          - compare_versions(version, '>= 4.4.0', '< 4.9.1')
