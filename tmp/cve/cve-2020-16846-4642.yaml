id: CVE-2020-16846
info:
  name: SaltStack Shell Injection
  author: dwisiswant0
  severity: critical
  description: |
    SaltStack Salt through 3002. Sending crafted web requests to the Salt API,
    with the SSH client enabled, can result in shell injection.

    This template supports the detection part only. See references.
  reference: |
    - https://mp.weixin.qq.com/s/R8qw_lWizGyeJS0jOcYXag
    - https://github.com/vulhub/vulhub/tree/master/saltstack/CVE-2020-16846
  tags: cve,cve2020,saltstack
requests:
  - payloads:
      Subdomains: /home/mahmoud/Wordlist/AllSubdomains.txt
    attack: sniper
    threads: 100
    raw:
      - |
        POST /run HTTP/1.1
        Host: {{Subdomains}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:68.0) Gecko/20100101 Firefox/68.0
        Content-Type: application/x-www-form-urlencoded

        token=1337&client=ssh&tgt=*&fun=a&roster=projectdiscovery&ssh_priv=nuclei
    matchers-condition: and
    matchers:
      - type: status
        status:
          - 500
      - type: word
        words:
          - "application/json"
        part: header
      - type: word
        words:
          - "An unexpected error occurred"
        part: body
