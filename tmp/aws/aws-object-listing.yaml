id: aws-object-listing

info:
  name: AWS bucket with Object listing
  author: reewardius
  severity: medium
  reference:
    - https://mikey96.medium.com/cloud-based-storage-misconfigurations-critical-bounties-361647f78a29
  tags: aws,amazon,provider,generic,s3,bucket,listing,fuzzing

http:
  - method: GET
    path:
      - "{{BaseURL}}/"
      - "{{BaseURL}}/2019/"
      - "{{BaseURL}}/2020/"
      - "{{BaseURL}}/2021/"
      - "{{BaseURL}}/2022/"
      - "{{BaseURL}}/2023/"
      - "{{BaseURL}}/2024/"
      - "{{BaseURL}}/2025/"
      - "{{BaseURL}}/2026/"
      - "{{BaseURL}}/admin/"
      - "{{BaseURL}}/app/"
      - "{{BaseURL}}/archive/"
      - "{{BaseURL}}/assets/"
      - "{{BaseURL}}/attachements/"
      - "{{BaseURL}}/backup/"
      - "{{BaseURL}}/backups/"
      - "{{BaseURL}}/blob/"
      - "{{BaseURL}}/blobs/"
      - "{{BaseURL}}/build/"
      - "{{BaseURL}}/builds/"
      - "{{BaseURL}}/cdn/"
      - "{{BaseURL}}/code/"
      - "{{BaseURL}}/conf/"
      - "{{BaseURL}}/config/"
      - "{{BaseURL}}/customers/"
      - "{{BaseURL}}/data/"
      - "{{BaseURL}}/dev/"
      - "{{BaseURL}}/development/"
      - "{{BaseURL}}/document/"
      - "{{BaseURL}}/documents/"
      - "{{BaseURL}}/download/"
      - "{{BaseURL}}/downloads/"
      - "{{BaseURL}}/dump/"
      - "{{BaseURL}}/file/"
      - "{{BaseURL}}/files/"
      - "{{BaseURL}}/image/"
      - "{{BaseURL}}/images/"
      - "{{BaseURL}}/img/"
      - "{{BaseURL}}/js/"
      - "{{BaseURL}}/log/"
      - "{{BaseURL}}/logs/"
      - "{{BaseURL}}/media/"
      - "{{BaseURL}}/pdf/"
      - "{{BaseURL}}/photo/"
      - "{{BaseURL}}/photos/"
      - "{{BaseURL}}/pics/"
      - "{{BaseURL}}/private/"
      - "{{BaseURL}}/prod/"
      - "{{BaseURL}}/production/"
      - "{{BaseURL}}/public/"
      - "{{BaseURL}}/resource/"
      - "{{BaseURL}}/resources/"
      - "{{BaseURL}}/scripts/"
      - "{{BaseURL}}/source/"
      - "{{BaseURL}}/static/"
      - "{{BaseURL}}/storage/"
      - "{{BaseURL}}/store/"
      - "{{BaseURL}}/temp/"
      - "{{BaseURL}}/tmp/"
      - "{{BaseURL}}/upload/"
      - "{{BaseURL}}/uploads/"
      - "{{BaseURL}}/users/"
      - "{{BaseURL}}/video/"
      - "{{BaseURL}}/videos/"
      - "{{BaseURL}}/web/"
      - "{{BaseURL}}/wordpress/"
      - "{{BaseURL}}/www/"
      - "{{Host}}.s3.amazonaws.com/"
      - "{{Host}}.s3.amazonaws.com/2015/"
      - "{{Host}}.s3.amazonaws.com/2016/"
      - "{{Host}}.s3.amazonaws.com/2017/"
      - "{{Host}}.s3.amazonaws.com/2018/"
      - "{{Host}}.s3.amazonaws.com/2019/"
      - "{{Host}}.s3.amazonaws.com/2020/"
      - "{{Host}}.s3.amazonaws.com/2021/"
      - "{{Host}}.s3.amazonaws.com/2022/"
      - "{{Host}}.s3.amazonaws.com/2023/"
      - "{{Host}}.s3.amazonaws.com/2024/"
      - "{{Host}}.s3.amazonaws.com/2025/"
      - "{{Host}}.s3.amazonaws.com/2026/"
      - "{{Host}}.s3.amazonaws.com/2027/"
      - "{{Host}}.s3.amazonaws.com/2028/"
      - "{{Host}}.s3.amazonaws.com/2029/"
      - "{{Host}}.s3.amazonaws.com/2030/"
      - "{{Host}}.s3.amazonaws.com/admin/"
      - "{{Host}}.s3.amazonaws.com/app/"
      - "{{Host}}.s3.amazonaws.com/archive/"
      - "{{Host}}.s3.amazonaws.com/assets/"
      - "{{Host}}.s3.amazonaws.com/attachements/"
      - "{{Host}}.s3.amazonaws.com/backup/"
      - "{{Host}}.s3.amazonaws.com/backups/"
      - "{{Host}}.s3.amazonaws.com/cdn/"
      - "{{Host}}.s3.amazonaws.com/code/"
      - "{{Host}}.s3.amazonaws.com/config/"
      - "{{Host}}.s3.amazonaws.com/customers/"
      - "{{Host}}.s3.amazonaws.com/data/"
      - "{{Host}}.s3.amazonaws.com/dev/"
      - "{{Host}}.s3.amazonaws.com/development/"
      - "{{Host}}.s3.amazonaws.com/document/"
      - "{{Host}}.s3.amazonaws.com/documents/"
      - "{{Host}}.s3.amazonaws.com/download/"
      - "{{Host}}.s3.amazonaws.com/downloads/"
      - "{{Host}}.s3.amazonaws.com/dump/"
      - "{{Host}}.s3.amazonaws.com/file/"
      - "{{Host}}.s3.amazonaws.com/files/"
      - "{{Host}}.s3.amazonaws.com/image/"
      - "{{Host}}.s3.amazonaws.com/images/"
      - "{{Host}}.s3.amazonaws.com/img/"
      - "{{Host}}.s3.amazonaws.com/js/"
      - "{{Host}}.s3.amazonaws.com/log/"
      - "{{Host}}.s3.amazonaws.com/logs/"
      - "{{Host}}.s3.amazonaws.com/media/"
      - "{{Host}}.s3.amazonaws.com/pdf/"
      - "{{Host}}.s3.amazonaws.com/photo/"
      - "{{Host}}.s3.amazonaws.com/photos/"
      - "{{Host}}.s3.amazonaws.com/pics/"
      - "{{Host}}.s3.amazonaws.com/private/"
      - "{{Host}}.s3.amazonaws.com/prod/"
      - "{{Host}}.s3.amazonaws.com/production/"
      - "{{Host}}.s3.amazonaws.com/public/"
      - "{{Host}}.s3.amazonaws.com/resource/"
      - "{{Host}}.s3.amazonaws.com/resources/"
      - "{{Host}}.s3.amazonaws.com/scripts/"
      - "{{Host}}.s3.amazonaws.com/source/"
      - "{{Host}}.s3.amazonaws.com/static/"
      - "{{Host}}.s3.amazonaws.com/static/assets/"
      - "{{Host}}.s3.amazonaws.com/static/js/"
      - "{{Host}}.s3.amazonaws.com/storage/"
      - "{{Host}}.s3.amazonaws.com/store/"
      - "{{Host}}.s3.amazonaws.com/upload/"
      - "{{Host}}.s3.amazonaws.com/uploads/"
      - "{{Host}}.s3.amazonaws.com/users/"
      - "{{Host}}.s3.amazonaws.com/video/"
      - "{{Host}}.s3.amazonaws.com/videos/"
      - "{{Host}}.s3.amazonaws.com/web/"
      - "{{Host}}.s3.amazonaws.com/wordpress/"
      - "{{Host}}.s3.amazonaws.com/www/"
      
    max-size: 1000
    stop-at-first-match: true
    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - '<ListBucketResult xmlns='
          - '<StorageClass'
        condition: and

      - type: word
        part: header
        words:
          - application/xml
          
    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - '<Name>([a-z0-9-._]+)'